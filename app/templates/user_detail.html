<!-- User Detail Modal Template for htmx loading - standalone fragment -->
<div class="modal-dialog modal-dialog-centered modal-lg">
  <div class="modal-content">
    <!-- Modal Header -->
    <div class="modal-header">
      <h5 class="modal-title">User Details</h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
    
    {% if weights %}
        {% set user_weight = weights|first %}
    {% else %}
        {% set user_weight = None %}
    {% endif %}
    
    <!-- Modal Body -->
    <div class="modal-body">
      <div class="row mb-3">
        <div class="col-md-12">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">{{ user.name }}</h5>
              
              <!-- User Source Badge -->
              <div class="mb-3">
                {% if user.account_type.name == 'Twitch' %}
                <span class="badge" style="background-color: #9147FF;">
                  <i class="bi bi-twitch"></i> Twitch
                </span>
                {% elif user.account_type.name == 'Discord' %}
                <span class="badge" style="background-color: #5865F2;">
                  <i class="bi bi-discord"></i> Discord
                </span>
                {% endif %}
                <span class="badge bg-secondary">ID: {{ user.id }}</span>
                
                <!-- Moderation Status -->
                <div id="user-status-{{ user.id }}" class="d-inline">
                  {% include 'components/user_moderation_status.html' %}
                </div>
              </div>
              
              <!-- User Stats -->
              <div class="mb-3">
                <h6>User Statistics</h6>
                <ul class="list-group list-group-flush">
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    Submissions
                    <span class="badge bg-primary rounded-pill">{{ submissions|length }}</span>
                  </li>
                  
                  {% if user_weight %}
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    Current Weight
                    <span class="badge {% if user_weight.weight <= 0.5 %}bg-warning{% else %}bg-success{% endif %} rounded-pill">
                      {{ user_weight.weight }}
                    </span>
                  </li>
                  {% endif %}
                  
                  {% if user.disabled %}
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    Status
                    <span class="badge bg-warning">Disabled</span>
                  </li>
                  {% endif %}
                  
                  {% if user.ignore_weight_penalty %}
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    Weight Penalties
                    <span class="badge bg-info">Ignored</span>
                  </li>
                  {% endif %}
                </ul>
              </div>
              
              <!-- Recent Submissions with Scrollbar -->
              <div class="mb-3">
                <h6 class="mb-2">Recent Submissions ({{ submissions|length }})</h6>
                
                <div id="submissions-container">
                  {% if submissions %}
                  <div class="list-group" style="max-height: 300px; overflow-y: auto;">
                    {% for submission in submissions %}
                    <div class="list-group-item list-group-item-action">
                      <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1 text-truncate" title="{{ submission.content.title }}">
                          {{ submission.content.title|truncate(40) }}
                        </h6>
                        <small>{{ submission.submitted_at.strftime('%Y-%m-%d') }}</small>
                      </div>
                      {% if submission.user_comment %}
                      <p class="mb-1 small fst-italic">"{{ submission.user_comment }}"</p>
                      {% endif %}
                      <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">Weight: {{ submission.weight }}</small>
                        {% if submission.content.url %}
                        <a href="{{ submission.content.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                          <i class="bi bi-link-45deg"></i>
                        </a>
                        {% endif %}
                      </div>
                    </div>
                    {% endfor %}
                  </div>
                  {% else %}
                  <p class="text-muted">No submissions found</p>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Modal Footer with Channel-Specific Actions Only -->
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      
      <!-- Channel-Specific Moderation Actions -->
      <div class="btn-group" role="group">
        <!-- Timeout Dropdown -->
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-warning dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-clock me-1"></i> Timeout
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#" 
                   hx-post="{{ url_for('users.timeout_user', user_id=user.id) }}"
                   hx-vals='{"channel_id": "{{ channel_id }}", "duration_seconds": "60", "reason": "1 minute timeout"}'
                   hx-target="#user-status-{{ user.id }}"
                   hx-confirm="Timeout user for 1 minute?">1 minute</a></li>
            <li><a class="dropdown-item" href="#" 
                   hx-post="{{ url_for('users.timeout_user', user_id=user.id) }}"
                   hx-vals='{"channel_id": "{{ channel_id }}", "duration_seconds": "300", "reason": "5 minute timeout"}'
                   hx-target="#user-status-{{ user.id }}"
                   hx-confirm="Timeout user for 5 minutes?">5 minutes</a></li>
            <li><a class="dropdown-item" href="#" 
                   hx-post="{{ url_for('users.timeout_user', user_id=user.id) }}"
                   hx-vals='{"channel_id": "{{ channel_id }}", "duration_seconds": "600", "reason": "10 minute timeout"}'
                   hx-target="#user-status-{{ user.id }}"
                   hx-confirm="Timeout user for 10 minutes?">10 minutes</a></li>
            <li><a class="dropdown-item" href="#" 
                   hx-post="{{ url_for('users.timeout_user', user_id=user.id) }}"
                   hx-vals='{"channel_id": "{{ channel_id }}", "duration_seconds": "1800", "reason": "30 minute timeout"}'
                   hx-target="#user-status-{{ user.id }}"
                   hx-confirm="Timeout user for 30 minutes?">30 minutes</a></li>
            <li><a class="dropdown-item" href="#" 
                   hx-post="{{ url_for('users.timeout_user', user_id=user.id) }}"
                   hx-vals='{"channel_id": "{{ channel_id }}", "duration_seconds": "3600", "reason": "1 hour timeout"}'
                   hx-target="#user-status-{{ user.id }}"
                   hx-confirm="Timeout user for 1 hour?">1 hour</a></li>
            <li><a class="dropdown-item" href="#" 
                   hx-post="{{ url_for('users.timeout_user', user_id=user.id) }}"
                   hx-vals='{"channel_id": "{{ channel_id }}", "duration_seconds": "14400", "reason": "4 hour timeout"}'
                   hx-target="#user-status-{{ user.id }}"
                   hx-confirm="Timeout user for 4 hours?">4 hours</a></li>
            <li><a class="dropdown-item" href="#" 
                   hx-post="{{ url_for('users.timeout_user', user_id=user.id) }}"
                   hx-vals='{"channel_id": "{{ channel_id }}", "duration_seconds": "86400", "reason": "24 hour timeout"}'
                   hx-target="#user-status-{{ user.id }}"
                   hx-confirm="Timeout user for 24 hours?">24 hours</a></li>
          </ul>
        </div>
        
        <!-- Ban from Channel Button with Confirmation -->
        <button type="button" class="btn btn-danger"
                hx-post="{{ url_for('users.ban_user', user_id=user.id) }}"
                hx-vals='{"scope": "channel", "channel_id": "{{ channel_id }}", "reason": "Banned from channel by moderator"}'
                hx-target="#user-status-{{ user.id }}"
                hx-confirm="Are you sure you want to ban this user from the channel?">
          <i class="bi bi-slash-circle me-1"></i> Ban from Channel
        </button>
      </div>
      
    </div>
  </div>
</div>

